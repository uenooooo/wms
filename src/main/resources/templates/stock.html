<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<title>在庫一覧</title>

	<style>
		table {
			border-collapse: collapse;
			width: 100%;
			table-layout: fixed;
		}

		th,
		td {
			border: 1px solid #ccc;
			padding: 6px 8px;
			text-align: left;
		}

		th {
			background-color: #f0f0f0;
		}

		td.num {
			text-align: right;
		}

		th.product-cd,
		td.product-cd {
			width: 150px;
			white-space: nowrap;
			overflow: hidden;
			text-overflow: ellipsis;
		}

		th.product-name,
		td.product-name {
			width: 360px;
			white-space: nowrap;
			overflow: hidden;
			text-overflow: ellipsis;
		}

		.title-area {
			font-size: 20px;
			font-weight: bold;
			margin-bottom: 8px;
		}

		.content-area {
			display: flex;
			gap: 16px;
		}

		.table-area {
			flex: 1;
		}

		.action-area {
			min-width: 260px;
			border: 1px solid #ccc;
			padding: 12px;
		}

		tr.clickable {
			cursor: pointer;
		}

		tr.clickable:hover {
			background-color: #f5f5f5;
		}

		tr.selected {
			background-color: #dbeafe;
		}

		.input-area {
			margin-top: 12px;
		}

		.form-row {
			display: flex;
			align-items: center;
			margin-bottom: 8px;
		}

		.form-row label {
			width: 80px;
			text-align: right;
			margin-right: 8px;
			font-size: 13px;
		}

		.form-row input {
			width: 140px;
			box-sizing: border-box;
		}

		.product-form {
			margin-top: 24px;
			border-top: 1px solid #ccc;
			padding-top: 12px;
		}

		/* ★ 右下ボタン用 */
		.form-footer {
			margin-top: 12px;
			display: flex;
			justify-content: flex-end;
		}

		.error-message {
			color: red;
			font-weight: bold;
			margin-bottom: 8px;
		}
	</style>
</head>

<body>

	<div class="title-area">在庫一覧</div>

	<div class="content-area">
		<div class="action-area">

			<div class="input-area">
				<div class="form-row">
					<label>入荷数量</label>
					<input type="number" id="receiveQty" min="1">
				</div>
				<div class="form-footer">
					<button type="button" onclick="submitReceive()">入荷確定</button>
				</div>
			</div>

			<div class="input-area">
				<div class="form-row">
					<label>出荷数量</label>
					<input type="number" id="shipQty" min="1">
				</div>
				<div class="form-footer">
					<button type="button" onclick="submitShip()">出荷確定</button>
				</div>
			</div>

			<!-- 商品マスタ登録 -->
			<div class="product-form">
				<h4>商品マスタ登録</h4>

				<div th:if="${addErrorMessage}" class="error-message">
					<p th:text="${addErrorMessage}"></p>
				</div>

				<form method="post" th:action="@{/product/add}">
					<div class="form-row">
						<label>商品コード</label>
						<input type="text" name="productCd" required maxlength="50">
					</div>
					<div class="form-row">
						<label>商品名</label>
						<input type="text" name="productName" required maxlength="200">
					</div>
					<div class="form-row">
						<label>単価</label>
						<input type="number" name="price" min="0">
					</div>

					<div class="form-footer">
						<button type="submit">登録</button>
					</div>
				</form>
			</div>

			<!-- 商品マスタ編集 -->
			<div class="product-form">
				<h4>商品マスタ編集</h4>

				<div th:if="${editErrorMessage}" class="error-message">
					<p th:text="${editErrorMessage}"></p>
				</div>

				<form method="post" th:action="@{/product/edit}">
					<input type="hidden" name="productId" id="editProductId">

					<div class="form-row">
						<label>商品コード</label>
						<input type="text" name="productCd" id="editProductCd" required maxlength="50">
					</div>
					<div class="form-row">
						<label>商品名</label>
						<input type="text" name="productName" id="editProductName" required maxlength="200">
					</div>
					<div class="form-row">
						<label>単価</label>
						<input type="number" name="price" id="editPrice" min="0">
					</div>

					<div class="form-footer">
						<button type="submit">更新</button>
					</div>
				</form>

				<div style="margin-top:4px;font-size:12px;">
					※ 一覧の行をクリックすると編集できます
				</div>
			</div>
		</div>

		<!-- 一覧 -->
		<div class="table-area">
			<table>
				<thead>
					<tr>
						<th class="product-cd">商品コード</th>
						<th class="product-name">商品名</th>
						<th>在庫数</th>
						<th>単価</th>
						<th>作成日時</th>
						<th>更新日時</th>
					</tr>
				</thead>
				<tbody>
					<tr th:each="row : ${stockList}"
						class="clickable"
						th:data-product-id="${row.productId}"
						onclick="selectProduct(this)">
						<td class="product-cd" th:text="${row.productCd}"></td>
						<td class="product-name" th:text="${row.productName}"></td>
						<td class="num" th:text="${row.stockQty}"></td>
						<td class="num" th:text="${row.price}"></td>
						<td th:text="${#dates.format(row.creTime, 'yyyy-MM-dd HH:mm:ss')}"></td>
						<td th:text="${#dates.format(row.updTime, 'yyyy-MM-dd HH:mm:ss')}"></td>
					</tr>
				</tbody>
			</table>
		</div>
	</div>

	<script>
		let selectedRow = null;

		function selectProduct(row) {
			if (selectedRow === row) {
				row.classList.remove('selected');
				selectedRow = null;
				editProductId.value = '';
				editProductCd.value = '';
				editProductName.value = '';
				editPrice.value = '';
				return;
			}

			document.querySelectorAll('tr.selected')
				.forEach(r => r.classList.remove('selected'));

			row.classList.add('selected');
			selectedRow = row;

			editProductId.value = row.dataset.productId;
			editProductCd.value = row.cells[0].innerText;
			editProductName.value = row.cells[1].innerText;
			editPrice.value = row.cells[3].innerText;
		}
	</script>

</body>
</html>
